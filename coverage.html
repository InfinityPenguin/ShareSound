<!DOCTYPE html><html><head><title>Coverage</title><meta charset="utf-8"><script>

headings = [];

onload = function(){
  headings = document.querySelectorAll('h2');
};

onscroll = function(e){
  var heading = find(window.scrollY);
  if (!heading) return;
  var links = document.querySelectorAll('#menu a')
    , link;

  for (var i = 0, len = links.length; i < len; ++i) {
    link = links[i];
    link.className = link.getAttribute('href') == '#' + heading.id
      ? 'active'
      : '';
  }
};

function find(y) {
  var i = headings.length
    , heading;

  while (i--) {
    heading = headings[i];
    if (y >= heading.offsetTop) {
      return heading;
    }
  }
}
</script>
<style>

body {
  font: 14px/1.6 "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 0;
  color: #2C2C2C;
  border-top: 2px solid #ddd;
}

#coverage {
  padding: 60px;
}

h1 a {
  color: inherit;
  font-weight: inherit;
}

h1 a:hover {
  text-decoration: none;
}

.onload h1 {
  opacity: 1;
}

h2 {
  width: 80%;
  margin-top: 80px;
  margin-bottom: 0;
  font-weight: 100;
  letter-spacing: 1px;
  border-bottom: 1px solid #eee;
}

a {
  color: #8A6343;
  font-weight: bold;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

ul {
  margin-top: 20px;
  padding: 0 15px;
  width: 100%;
}

ul li {
  float: left;
  width: 40%;
  margin-top: 5px;
  margin-right: 60px;
  list-style: none;
  border-bottom: 1px solid #eee;
  padding: 5px 0;
  font-size: 12px;
}

ul::after {
  content: '.';
  height: 0;
  display: block;
  visibility: hidden;
  clear: both;
}

code {
  font: 12px monaco, monospace;
}

pre {
  margin: 30px;
  padding: 30px;
  border: 1px solid #eee;
  border-bottom-color: #ddd;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 0 10px #eee;
  -moz-box-shadow: inset 0 0 10px #eee;
  box-shadow: inset 0 0 10px #eee;
  overflow-x: auto;
}

img {
  margin: 30px;
  padding: 1px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  -moz-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  max-width: 100%;
}

footer {
  background: #eee;
  width: 100%;
  padding: 50px 0;
  text-align: right;
  border-top: 1px solid #ddd;
}

footer span {
  display: block;
  margin-right: 30px;
  color: #888;
  font-size: 12px;
}

#menu {
  position: fixed;
  font-size: 12px;
  overflow-y: auto;
  top: 0;
  right: 0;
  margin: 0;
  height: 100%;
  padding: 15px 0;
  text-align: right;
  border-left: 1px solid #eee;
  -moz-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-font-smoothing: antialiased;
  background: url("data:image/png;base64,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");
}

#menu::after {
  display: block;
  content: '';
  padding-top: 80px;
}

#logo {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: rgba(255,255,255,.1);
  font-size: 11px;
  display: block;
  width: 20px;
  height: 20px;
  line-height: 20px;
  text-align: center;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  border-radius: 20px;
  -webkit-box-shadow: 0 0 3px rgba(0,0,0,.2);
  -moz-box-shadow: 0 0 3px rgba(0,0,0,.2);
  box-shadow: 0 0 3px rgba(0,0,0,.2);
  color: inherit;
}

#menu li a {
  display: block;
  color: white;
  padding: 0 35px 0 25px;
  -webkit-transition: background 300ms;
  -moz-transition: background 300ms;
}

#menu li {
  position: relative;
  list-style: none;
}

#menu a:hover,
#menu a.active {
  text-decoration: none;
  background: rgba(255,255,255,.1);
}

#menu li:hover .cov {
  opacity: 1;
}

#menu li .dirname {
  opacity: .60;
  padding-right: 2px;
}

#menu li .basename {
  opacity: 1;
}

#menu .cov {
  background: rgba(0,0,0,.4);
  position: absolute;
  top: 0;
  right: 8px;
  font-size: 9px;
  opacity: .6;
  text-align: left;
  width: 17px;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  border-radius: 10px;
  padding: 2px 3px;
  text-align: center;
}

#stats:nth-child(2n) {
  display: inline-block;
  margin-top: 15px;
  border: 1px solid #eee;
  padding: 10px;
  -webkit-box-shadow: inset 0 0 2px #eee;
  -moz-box-shadow: inset 0 0 2px #eee;
  box-shadow: inset 0 0 2px #eee;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
}

#stats div {
  float: left;
  padding: 0 5px;
}

#stats::after {
  display: block;
  content: '';
  clear: both;
}

#stats .sloc::after {
  content: ' SLOC';
  color: #b6b6b6;
}

#stats .percentage::after {
  content: ' coverage';
  color: #b6b6b6;
}

#stats .hits,
#stats .misses {
  display: none;
}

.high {
  color: #00d4b4;
}
.medium {
  color: #e87d0d;
}
.low {
  color: #d4081a;
}
.terrible {
  color: #d4081a;
  font-weight: bold;
}

table {
  width: 80%;
  margin-top: 10px;
  border-collapse: collapse;
  border: 1px solid #cbcbcb;
  color: #363636;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
}

table thead {
  display: none;
}

table td.line,
table td.hits {
  width: 20px;
  background: #eaeaea;
  text-align: center;
  font-size: 11px;
  padding: 0 10px;
  color: #949494;
}

table td.hits {
  width: 10px;
  padding: 2px 5px;
  color: rgba(0,0,0,.2);
  background: #f0f0f0;
}

tr.miss td.line,
tr.miss td.hits {
  background: #e6c3c7;
}

tr.miss td {
  background: #f8d5d8;
}

td.source {
  padding-left: 15px;
  line-height: 15px;
  white-space: pre;
  font: 12px monaco, monospace;
}

code .comment { color: #ddd }
code .init { color: #2F6FAD }
code .string { color: #5890AD }
code .keyword { color: #8A6343 }
code .number { color: #2F6FAD }
</style>
</head><body><div id="coverage"><h1 id="overview">Coverage</h1><div id="menu"><li><a href="#overview">overview</a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/api/thing/index.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/thing/</span><span class="basename">index.js</span></a></li><li><span class="cov low">35</span><a href="#/Users/helenhan/ShareSound/server/api/thing/thing.controller.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/thing/</span><span class="basename">thing.controller.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/api/thing/thing.model.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/thing/</span><span class="basename">thing.model.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/api/thing/thing.spec.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/thing/</span><span class="basename">thing.spec.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/api/track/index.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/track/</span><span class="basename">index.js</span></a></li><li><span class="cov low">28</span><a href="#/Users/helenhan/ShareSound/server/api/track/track.controller.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/track/</span><span class="basename">track.controller.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/api/track/track.model.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/track/</span><span class="basename">track.model.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/api/track/track.spec.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/track/</span><span class="basename">track.spec.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/api/user/index.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/user/</span><span class="basename">index.js</span></a></li><li><span class="cov medium">73</span><a href="#/Users/helenhan/ShareSound/server/api/user/user.controller.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/user/</span><span class="basename">user.controller.js</span></a></li><li><span class="cov high">91</span><a href="#/Users/helenhan/ShareSound/server/api/user/user.model.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/user/</span><span class="basename">user.model.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/api/user/user.model.spec.js"><span class="dirname">/Users/helenhan/ShareSound/server/api/user/</span><span class="basename">user.model.spec.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/app.js"><span class="dirname">/Users/helenhan/ShareSound/server/</span><span class="basename">app.js</span></a></li><li><span class="cov medium">55</span><a href="#/Users/helenhan/ShareSound/server/auth/auth.service.js"><span class="dirname">/Users/helenhan/ShareSound/server/auth/</span><span class="basename">auth.service.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/auth/facebook/index.js"><span class="dirname">/Users/helenhan/ShareSound/server/auth/facebook/</span><span class="basename">index.js</span></a></li><li><span class="cov low">30</span><a href="#/Users/helenhan/ShareSound/server/auth/facebook/passport.js"><span class="dirname">/Users/helenhan/ShareSound/server/auth/facebook/</span><span class="basename">passport.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/auth/index.js"><span class="dirname">/Users/helenhan/ShareSound/server/auth/</span><span class="basename">index.js</span></a></li><li><span class="cov medium">53</span><a href="#/Users/helenhan/ShareSound/server/auth/local/index.js"><span class="dirname">/Users/helenhan/ShareSound/server/auth/local/</span><span class="basename">index.js</span></a></li><li><span class="cov low">36</span><a href="#/Users/helenhan/ShareSound/server/auth/local/passport.js"><span class="dirname">/Users/helenhan/ShareSound/server/auth/local/</span><span class="basename">passport.js</span></a></li><li><span class="cov terrible">22</span><a href="#/Users/helenhan/ShareSound/server/components/errors/index.js"><span class="dirname">/Users/helenhan/ShareSound/server/components/errors/</span><span class="basename">index.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/config/environment/development.js"><span class="dirname">/Users/helenhan/ShareSound/server/config/environment/</span><span class="basename">development.js</span></a></li><li><span class="cov medium">66</span><a href="#/Users/helenhan/ShareSound/server/config/environment/index.js"><span class="dirname">/Users/helenhan/ShareSound/server/config/environment/</span><span class="basename">index.js</span></a></li><li><span class="cov high">88</span><a href="#/Users/helenhan/ShareSound/server/config/express.js"><span class="dirname">/Users/helenhan/ShareSound/server/config/</span><span class="basename">express.js</span></a></li><li><span class="cov high">100</span><a href="#/Users/helenhan/ShareSound/server/config/seed.js"><span class="dirname">/Users/helenhan/ShareSound/server/config/</span><span class="basename">seed.js</span></a></li><li><span class="cov high">90</span><a href="#/Users/helenhan/ShareSound/server/routes.js"><span class="dirname">/Users/helenhan/ShareSound/server/</span><span class="basename">routes.js</span></a></li><a id="logo" href="http://visionmedia.github.io/mocha/">m</a></div><div id="stats" class="medium"><div class="percentage">73%</div><div class="sloc">563</div><div class="hits">413</div><div class="misses">150</div></div><div id="files"><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/thing/index.js">/Users/helenhan/ShareSound/server/api/thing/index.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">11</div><div class="hits">11</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var express = require('express');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var controller = require('./thing.controller');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var router = express.Router();</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">router.get('/', controller.index);</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">router.get('/:id', controller.show);</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">router.post('/', controller.create);</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">router.put('/:id', controller.update);</td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">router.patch('/:id', controller.update);</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">router.delete('/:id', controller.destroy);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">module.exports = router;</td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/thing/thing.controller.js">/Users/helenhan/ShareSound/server/api/thing/thing.controller.js</h2><div id="stats" class="low"><div class="percentage">35%</div><div class="sloc">34</div><div class="hits">12</div><div class="misses">22</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Using Rails-like standard naming convention for endpoints.</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * GET     /things              -&gt;  index</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> * POST    /things              -&gt;  create</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> * GET     /things/:id          -&gt;  show</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> * PUT     /things/:id          -&gt;  update</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> * DELETE  /things/:id          -&gt;  destroy</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var _ = require('lodash');</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">var Thing = require('./thing.model');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">// Get list of things</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">exports.index = function(req, res) {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">  Thing.find(function (err, things) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">    if(err) { return handleError(res, err); }</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">    return res.json(200, things);</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">// Get a single thing</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">exports.show = function(req, res) {</td></tr><tr class="miss"><td class="line">25</td><td class="hits">0</td><td class="source">  Thing.findById(req.params.id, function (err, thing) {</td></tr><tr class="miss"><td class="line">26</td><td class="hits">0</td><td class="source">    if(err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">27</td><td class="hits">0</td><td class="source">    if(!thing) { return res.send(404); }</td></tr><tr class="miss"><td class="line">28</td><td class="hits">0</td><td class="source">    return res.json(thing);</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">// Creates a new thing in the DB.</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">exports.create = function(req, res) {</td></tr><tr class="miss"><td class="line">34</td><td class="hits">0</td><td class="source">  Thing.create(req.body, function(err, thing) {</td></tr><tr class="miss"><td class="line">35</td><td class="hits">0</td><td class="source">    if(err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">36</td><td class="hits">0</td><td class="source">    return res.json(201, thing);</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">// Updates an existing thing in the DB.</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">exports.update = function(req, res) {</td></tr><tr class="miss"><td class="line">42</td><td class="hits">0</td><td class="source">  if(req.body._id) { delete req.body._id; }</td></tr><tr class="miss"><td class="line">43</td><td class="hits">0</td><td class="source">  Thing.findById(req.params.id, function (err, thing) {</td></tr><tr class="miss"><td class="line">44</td><td class="hits">0</td><td class="source">    if (err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">45</td><td class="hits">0</td><td class="source">    if(!thing) { return res.send(404); }</td></tr><tr class="miss"><td class="line">46</td><td class="hits">0</td><td class="source">    var updated = _.merge(thing, req.body);</td></tr><tr class="miss"><td class="line">47</td><td class="hits">0</td><td class="source">    updated.save(function (err) {</td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="source">      if (err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">49</td><td class="hits">0</td><td class="source">      return res.json(200, thing);</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">// Deletes a thing from the DB.</td></tr><tr class="hit"><td class="line">55</td><td class="hits">1</td><td class="source">exports.destroy = function(req, res) {</td></tr><tr class="miss"><td class="line">56</td><td class="hits">0</td><td class="source">  Thing.findById(req.params.id, function (err, thing) {</td></tr><tr class="miss"><td class="line">57</td><td class="hits">0</td><td class="source">    if(err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">58</td><td class="hits">0</td><td class="source">    if(!thing) { return res.send(404); }</td></tr><tr class="miss"><td class="line">59</td><td class="hits">0</td><td class="source">    thing.remove(function(err) {</td></tr><tr class="miss"><td class="line">60</td><td class="hits">0</td><td class="source">      if(err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">61</td><td class="hits">0</td><td class="source">      return res.send(204);</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">function handleError(res, err) {</td></tr><tr class="miss"><td class="line">67</td><td class="hits">0</td><td class="source">  return res.send(500, err);</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">}</td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/thing/thing.model.js">/Users/helenhan/ShareSound/server/api/thing/thing.model.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">4</div><div class="hits">4</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var mongoose = require('mongoose'),</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">    Schema = mongoose.Schema;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var ThingSchema = new Schema({</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">  name: String,</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">  info: String,</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">  active: Boolean</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">module.exports = mongoose.model('Thing', ThingSchema);</td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/thing/thing.spec.js">/Users/helenhan/ShareSound/server/api/thing/thing.spec.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">10</div><div class="hits">10</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var should = require('should');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var app = require('../../app');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var request = require('supertest');</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">describe('GET /api/things', function() {</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">  it('should respond with JSON array', function(done) {</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">    request(app)</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">      .get('/api/things')</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">      .expect(200)</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">      .expect('Content-Type', /json/)</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">      .end(function(err, res) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">        if (err) return done(err);</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">        res.body.should.be.instanceof(Array);</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">        done();</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/track/index.js">/Users/helenhan/ShareSound/server/api/track/index.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">13</div><div class="hits">13</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var express = require('express');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var controller = require('./track.controller');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var auth = require('../../auth/auth.service');</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var router = express.Router();</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">router.get('/', controller.index);</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">router.get('/uploadTrack', controller.getUploadURL);</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">router.post('/deleteTrack', controller.destroy);</td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">router.post('/downloadTrack', controller.download);</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">router.get('/foo', controller.foo);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">router.put('/', controller.upload);</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">router.get('/:id', controller.getUserTracks);</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">//router.get('/:id', controller.show);</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">//router.put('/:id', controller.update);</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">//router.patch('/:id', controller.update);</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">//router.delete('/:id', controller.destroy);</td></tr><tr class="hit"><td class="line">51</td><td class="hits">1</td><td class="source">module.exports = router;</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/track/track.controller.js">/Users/helenhan/ShareSound/server/api/track/track.controller.js</h2><div id="stats" class="low"><div class="percentage">28%</div><div class="sloc">80</div><div class="hits">23</div><div class="misses">57</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var _ = require('lodash');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var Track = require('./track.model');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var AWS = require('aws-sdk');</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">AWS.config.region = 'us-west-1';</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">var S3_BUCKET = 'sharesound';</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">var FAILURE = -1;</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">var SUCCESS = 1;</td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var supertrackid = &quot;&quot;;</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">// Get list of tracks</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">exports.index = function(req, res) {</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">	Track.find(function (err, tracks) {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">		if(err) { return handleError(res, err); }</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">		return res.json(200, tracks);</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">// Get a single track</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">exports.show = function(req, res) {</td></tr><tr class="miss"><td class="line">24</td><td class="hits">0</td><td class="source">	Track.findById(req.params.id, function (err, track) {</td></tr><tr class="miss"><td class="line">25</td><td class="hits">0</td><td class="source">		if(err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">26</td><td class="hits">0</td><td class="source">		if(!track) { return res.send(404); }</td></tr><tr class="miss"><td class="line">27</td><td class="hits">0</td><td class="source">		return res.json(track);</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">// Updates an existing track in the DB.</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">exports.update = function(req, res) {</td></tr><tr class="miss"><td class="line">33</td><td class="hits">0</td><td class="source">	if(req.body._id) { delete req.body._id; }</td></tr><tr class="miss"><td class="line">34</td><td class="hits">0</td><td class="source">	Track.findById(req.params.id, function (err, track) {</td></tr><tr class="miss"><td class="line">35</td><td class="hits">0</td><td class="source">		if (err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">36</td><td class="hits">0</td><td class="source">		if(!track) { return res.send(404); }</td></tr><tr class="miss"><td class="line">37</td><td class="hits">0</td><td class="source">		var updated = _.merge(track, req.body);</td></tr><tr class="miss"><td class="line">38</td><td class="hits">0</td><td class="source">		updated.save(function (err) {</td></tr><tr class="miss"><td class="line">39</td><td class="hits">0</td><td class="source">			if (err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">40</td><td class="hits">0</td><td class="source">			return res.json(200, track);</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">		});</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">// Deletes a track from the DB.</td></tr><tr class="hit"><td class="line">46</td><td class="hits">1</td><td class="source">exports.destroy = function(req, res) {</td></tr><tr class="miss"><td class="line">47</td><td class="hits">0</td><td class="source">	Track.findById(req.params.id, function (err, track) {</td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="source">		if(err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">49</td><td class="hits">0</td><td class="source">		if(!track) { return res.send(404); }</td></tr><tr class="miss"><td class="line">50</td><td class="hits">0</td><td class="source">		track.remove(function(err) {</td></tr><tr class="miss"><td class="line">51</td><td class="hits">0</td><td class="source">			if(err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">52</td><td class="hits">0</td><td class="source">			return res.send(204);</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">		});</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">exports.getUserTracks = function(req, res){</td></tr><tr class="miss"><td class="line">59</td><td class="hits">0</td><td class="source">	console.log(&quot;getting tracks for ..... &quot; + req.params.id); </td></tr><tr class="miss"><td class="line">60</td><td class="hits">0</td><td class="source">	Track.find({uploader_id : req.params.id}, function (err, track) {</td></tr><tr class="miss"><td class="line">61</td><td class="hits">0</td><td class="source">		if(err) { return handleError(res, err); }</td></tr><tr class="miss"><td class="line">62</td><td class="hits">0</td><td class="source">		if(!track) { return res.send(404); }</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">64</td><td class="hits">0</td><td class="source">		console.log(&quot;Found tracks: &quot; + JSON.stringify(track));     </td></tr><tr class="miss"><td class="line">65</td><td class="hits">0</td><td class="source">		return res.json(track);</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">}; </td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">71</td><td class="hits">1</td><td class="source">exports.download = function(req, res) {</td></tr><tr class="miss"><td class="line">72</td><td class="hits">0</td><td class="source">	var s3 = new AWS.S3();</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">74</td><td class="hits">0</td><td class="source">	res.setHeader('Content-disposition', 'attachment; filename=track.wma');</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">76</td><td class="hits">0</td><td class="source">	var params = {Bucket: 'sharesound', Key: 'prelude_in_c.wma'};</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">	// var file = require('fs').createWriteStream('./download_test_file.wma');</td></tr><tr class="miss"><td class="line">78</td><td class="hits">0</td><td class="source">	s3.getObject(params)</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">		.createReadStream().pipe(res);</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source">// Creates a new track in the DB.</td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">exports.create = function(req, res, callback) {</td></tr><tr class="miss"><td class="line">84</td><td class="hits">0</td><td class="source">	var userID = req.query.user;</td></tr><tr class="miss"><td class="line">85</td><td class="hits">0</td><td class="source">	var name = req.query.s3_object_name;</td></tr><tr class="miss"><td class="line">86</td><td class="hits">0</td><td class="source">	if (!Track.isValidTrack(name)) { </td></tr><tr class="miss"><td class="line">87</td><td class="hits">0</td><td class="source">		console.log(&quot;Invalid track name.&quot;);</td></tr><tr class="miss"><td class="line">88</td><td class="hits">0</td><td class="source">		supertrackid = null;</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">	} else {</td></tr><tr class="miss"><td class="line">90</td><td class="hits">0</td><td class="source">		req.body = { </td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">			name: name,</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">			uploader_id: userID</td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">		};</td></tr><tr class="miss"><td class="line">94</td><td class="hits">0</td><td class="source">		console.log('Created track for user: ' + userID);</td></tr><tr class="miss"><td class="line">95</td><td class="hits">0</td><td class="source">		Track.create(req.body, function(err, track) {</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">			//if(err) { return handleError(res, err); }</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">			//return res.json(201, track);</td></tr><tr class="miss"><td class="line">98</td><td class="hits">0</td><td class="source">			supertrackid = track._id.toString();</td></tr><tr class="miss"><td class="line">99</td><td class="hits">0</td><td class="source">			track.url = 'https://'+S3_BUCKET+'.s3.amazonaws.com/'+track._id;</td></tr><tr class="miss"><td class="line">100</td><td class="hits">0</td><td class="source">			callback();</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">		});</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">	}</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">105</td><td class="hits">1</td><td class="source">exports.getUploadURL = function(req, res) {</td></tr><tr class="miss"><td class="line">106</td><td class="hits">0</td><td class="source">	console.log('getUploadURL' + JSON.stringify(req.query));</td></tr><tr class="miss"><td class="line">107</td><td class="hits">0</td><td class="source">	var trackId;</td></tr><tr class="miss"><td class="line">108</td><td class="hits">0</td><td class="source">	exports.create(req, res, function() {</td></tr><tr class="miss"><td class="line">109</td><td class="hits">0</td><td class="source">		trackId = supertrackid;</td></tr><tr class="miss"><td class="line">110</td><td class="hits">0</td><td class="source">		if (!trackId) { return res.json(324, {'status code': FAILURE});}</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">112</td><td class="hits">0</td><td class="source">		AWS.config.update({accessKeyId: process.env.AWS_ACCESS_KEY, secretAccessKey: process.env.AWS_SECRET_KEY});</td></tr><tr class="miss"><td class="line">113</td><td class="hits">0</td><td class="source">		var s3 = new AWS.S3();</td></tr><tr class="miss"><td class="line">114</td><td class="hits">0</td><td class="source">		var s3_params = {</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">			Bucket: S3_BUCKET,</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">		Key: trackId,</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">		Expires: 9001,</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">		ContentType: req.query.s3_object_type,</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">		ACL: 'public-read-write'</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">		};</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">122</td><td class="hits">0</td><td class="source">		s3.getSignedUrl('putObject', s3_params, function(err, data){</td></tr><tr class="miss"><td class="line">123</td><td class="hits">0</td><td class="source">			if(err){ console.log(err); }</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">			else{</td></tr><tr class="miss"><td class="line">125</td><td class="hits">0</td><td class="source">				var return_data = {</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">					signed_request: data,</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source">			url: 'https://'+S3_BUCKET+'.s3.amazonaws.com/'+s3_params.Key</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">				};</td></tr><tr class="miss"><td class="line">129</td><td class="hits">0</td><td class="source">				res.write(JSON.stringify(return_data));</td></tr><tr class="miss"><td class="line">130</td><td class="hits">0</td><td class="source">				res.end();</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">			}</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source">		});</td></tr><tr><td class="line">133</td><td class="hits"></td><td class="source">	});</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">136</td><td class="hits">1</td><td class="source">exports.upload = function(req, res) {</td></tr><tr class="miss"><td class="line">137</td><td class="hits">0</td><td class="source">	var file = req.files.toUpload;</td></tr><tr class="miss"><td class="line">138</td><td class="hits">0</td><td class="source">	var options = {</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">	};</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">142</td><td class="hits">1</td><td class="source">exports.foo = function(req, res) {</td></tr><tr class="miss"><td class="line">143</td><td class="hits">0</td><td class="source">	console.log(&quot;FOOOOO&quot;);</td></tr><tr class="miss"><td class="line">144</td><td class="hits">0</td><td class="source">	console.log(JSON.stringify(req.query));</td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">147</td><td class="hits">1</td><td class="source">function handleError(res, err) {</td></tr><tr class="miss"><td class="line">148</td><td class="hits">0</td><td class="source">	return res.send(500, err);</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/track/track.model.js">/Users/helenhan/ShareSound/server/api/track/track.model.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">7</div><div class="hits">7</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var mongoose = require('mongoose'),</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">	Schema = mongoose.Schema;</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var TrackSchema = new Schema({</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">	name: String,</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">	url: String,</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">	uploader_id: String</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">TrackSchema.statics.isValidTrack = function (name, callback) {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">13</td><td class="source">	var extension = name.split('.').pop();</td></tr><tr class="hit"><td class="line">14</td><td class="hits">13</td><td class="source">	return ((name.indexOf('.') !== -1) &amp;&amp; (extension === 'mp3' || extension === 'wav' || extension === 'ogg'));</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">module.exports = mongoose.model('Track', TrackSchema);</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/track/track.spec.js">/Users/helenhan/ShareSound/server/api/track/track.spec.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">30</div><div class="hits">30</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var should = require('should');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var app = require('../../app');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var request = require('supertest');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var assert = require('assert');</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var Track = require('./track.model');</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">describe('GET /api/tracks', function() {</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">  it('should respond with JSON array', function(done) {</td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">    request(app)</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">      .get('/api/tracks')</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">      .expect(200)</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">      .expect('Content-Type', /json/)</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">      .end(function(err, res) {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">        if (err) return done(err);</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">        res.body.should.be.instanceof(Array);</td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">        done();</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">describe('.isValidTrack', function () {</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">  it('should return false for these shitty arguments', function (done) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack(''), false);</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('.ralph'), false);</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('mp3'), false);</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('wav'), false);</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('ogg'), false);</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('.mp4'), false);</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('ISAI.mp4'), false);</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">    done();</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">  it('should return true for these fucking amazing arguments', function (done) {</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('aidan.wav'), true);</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('ralphisactuallythe.ogg'), true);</td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('.wav'), true);</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('.ogg'), true);</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('.mp3'), true);</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">    assert.equal(Track.isValidTrack('happy.feet.mp3'), true);</td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">    done();</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/user/index.js">/Users/helenhan/ShareSound/server/api/user/index.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">13</div><div class="hits">13</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var express = require('express');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var controller = require('./user.controller');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var config = require('../../config/environment');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var auth = require('../../auth/auth.service');</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var User = require('./user.model');</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">var router = express.Router();</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">router.get('/', auth.hasRole('admin'), controller.index);</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">//router.delete('/:id', auth.hasRole('admin'), controller.destroy);</td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">router.get('/me', auth.isAuthenticated(), controller.me);</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">//router.put('/:id/password', auth.isAuthenticated(), controller.changePassword);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">//router.get('/:id', auth.isAuthenticated(), controller.show);</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">router.post('/', controller.create);</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">router.use('/login', require('../../auth/local')); </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">router.post('/create_user', controller.create); </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">module.exports = router;</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/user/user.controller.js">/Users/helenhan/ShareSound/server/api/user/user.controller.js</h2><div id="stats" class="medium"><div class="percentage">73%</div><div class="sloc">53</div><div class="hits">39</div><div class="misses">14</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var User = require('./user.model');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var passport = require('passport');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var config = require('../../config/environment');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var jwt = require('jsonwebtoken');</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">var ERR_USER_EXISTS = -1; </td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">var ERR_BAD_USERNAME = -2;</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">var ERR_BAD_PASSWORD = -3; </td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">var ERR_NO_USER = -1; </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var ERR_BAD_CREDENTIALS = -2; </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">var ERR_MISC = -1;</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var SUCCESS = 1; </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var validationError = function(res, err) {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">4</td><td class="source">    var errmsg = String(err); </td></tr><tr class="hit"><td class="line">18</td><td class="hits">4</td><td class="source">    var code = ERR_MISC; </td></tr><tr class="hit"><td class="line">19</td><td class="hits">4</td><td class="source">    if (errmsg.indexOf(&quot;Username cannot be blank&quot;) &gt; -1){</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">        code = ERR_BAD_USERNAME; </td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">22</td><td class="hits">3</td><td class="source">    else if (errmsg.indexOf(&quot;The specified username is already in use&quot;) &gt; -1 ){</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">        code = ERR_USER_EXISTS;    </td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">25</td><td class="hits">2</td><td class="source">    else if (errmsg.indexOf(&quot;Password must be between 5 and 39 characters&quot;) &gt; -1){</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">        code = ERR_BAD_PASSWORD; </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">    }</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">    else if (errmsg.indexOf(&quot;Username must be letters, numbers, underscores, or dashes&quot;) &gt; -1){</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">        code = ERR_BAD_USERNAME;    </td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    </td></tr><tr class="hit"><td class="line">32</td><td class="hits">4</td><td class="source">    err['status code'] = code;</td></tr><tr class="hit"><td class="line">33</td><td class="hits">4</td><td class="source">    return res.json(422, err);</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">    // return res.json({&quot;status code&quot; : code}); </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    </td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * Get list of users</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> * restriction: 'admin'</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">exports.index = function(req, res) {</td></tr><tr class="miss"><td class="line">43</td><td class="hits">0</td><td class="source">  User.find({}, '-salt -hashedPassword', function (err, users) {</td></tr><tr class="miss"><td class="line">44</td><td class="hits">0</td><td class="source">    if(err) return res.send(500, err);</td></tr><tr class="miss"><td class="line">45</td><td class="hits">0</td><td class="source">    res.json(200, users);</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source"> * Creates a new user</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">exports.create = function (req, res, next) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">6</td><td class="source">  console.log(req.body);</td></tr><tr class="hit"><td class="line">54</td><td class="hits">6</td><td class="source">  var newUser = new User(req.body);</td></tr><tr class="hit"><td class="line">55</td><td class="hits">6</td><td class="source">  newUser.provider = 'local';</td></tr><tr class="hit"><td class="line">56</td><td class="hits">6</td><td class="source">  newUser.role = 'user';</td></tr><tr class="hit"><td class="line">57</td><td class="hits">6</td><td class="source">  newUser.save(function(err, user) {</td></tr><tr class="hit"><td class="line">58</td><td class="hits">6</td><td class="source">    console.log(&quot;ERROR : &quot; + err); </td></tr><tr class="hit"><td class="line">59</td><td class="hits">10</td><td class="source">    if (err) return validationError(res, err);</td></tr><tr class="hit"><td class="line">60</td><td class="hits">2</td><td class="source">    var token = jwt.sign({_id: user._id }, config.secrets.session, { expiresInMinutes: 60*5 });</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    //res.json({ token: token });</td></tr><tr class="hit"><td class="line">62</td><td class="hits">2</td><td class="source">    res.json({&quot;status code&quot;: SUCCESS, token: token}); </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> * Get a single user</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">69</td><td class="hits">1</td><td class="source">exports.show = function (req, res, next) {</td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="source">  var userId = req.params.id;</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">72</td><td class="hits">0</td><td class="source">  User.findById(userId, function (err, user) {</td></tr><tr class="miss"><td class="line">73</td><td class="hits">0</td><td class="source">    if (err) return next(err);</td></tr><tr class="miss"><td class="line">74</td><td class="hits">0</td><td class="source">    if (!user) return res.send(401);</td></tr><tr class="miss"><td class="line">75</td><td class="hits">0</td><td class="source">    res.json(user.profile);</td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> * Deletes a user</td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source"> * restriction: 'admin'</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">exports.destroy = function(req, res) {</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">  User.findByIdAndRemove(req.params.id, function(err, user) {</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">    if(err) return res.send(500, err);</td></tr><tr><td class="line">86</td><td class="hits"></td><td class="source">    return res.send(204);</td></tr><tr><td class="line">87</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">88</td><td class="hits"></td><td class="source">};*/</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source"> * Change a users password</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">exports.changePassword = function(req, res, next) {</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">  var userId = req.user._id;</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">  var oldPass = String(req.body.oldPassword);</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">  var newPass = String(req.body.newPassword);</td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">98</td><td class="hits"></td><td class="source">  User.findById(userId, function (err, user) {</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">    if(user.authenticate(oldPass)) {</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">      user.password = newPass;</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">      user.save(function(err) {</td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">        if (err) return validationError(res, err);</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">        res.send(200);</td></tr><tr><td class="line">104</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">105</td><td class="hits"></td><td class="source">    } else {</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">      res.send(403);</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">108</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">}; */</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> * Get my info</td></tr><tr><td class="line">113</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">114</td><td class="hits">1</td><td class="source">exports.me = function(req, res, next) {</td></tr><tr class="miss"><td class="line">115</td><td class="hits">0</td><td class="source">  var userId = req.user._id;</td></tr><tr class="miss"><td class="line">116</td><td class="hits">0</td><td class="source">  User.findOne({</td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">    _id: userId</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">  }, '-salt -hashedPassword', function(err, user) { // don't ever give out the password or salt</td></tr><tr class="miss"><td class="line">119</td><td class="hits">0</td><td class="source">    if (err) return next(err);</td></tr><tr class="miss"><td class="line">120</td><td class="hits">0</td><td class="source">    if (!user) return res.json(401);</td></tr><tr class="miss"><td class="line">121</td><td class="hits">0</td><td class="source">    res.json(user);</td></tr><tr><td class="line">122</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">125</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source"> * Authentication callback</td></tr><tr><td class="line">127</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">128</td><td class="hits">1</td><td class="source">exports.authCallback = function(req, res, next) {</td></tr><tr class="miss"><td class="line">129</td><td class="hits">0</td><td class="source">  res.redirect('/');</td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/user/user.model.js">/Users/helenhan/ShareSound/server/api/user/user.model.js</h2><div id="stats" class="high"><div class="percentage">91%</div><div class="sloc">48</div><div class="hits">44</div><div class="misses">4</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var mongoose = require('mongoose');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var Schema = mongoose.Schema;</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var crypto = require('crypto');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var authTypes = ['github', 'twitter', 'facebook', 'google'];</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">var UserSchema = new Schema({</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  username: {</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">      type: String,</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">      default: ''</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  //email: { type: String, lowercase: true },</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">  role: {</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    type: String,</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">    default: 'user'</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  hashedPassword: {</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">      type: String,</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">      default: ''</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  }, </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  provider: String,</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  salt: String,</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  facebook: {},</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  github: {}</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> * Virtuals</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">UserSchema</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  .virtual('password')</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">  .set(function(password) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">9</td><td class="source">    this._password = password;</td></tr><tr class="hit"><td class="line">36</td><td class="hits">9</td><td class="source">    this.salt = this.makeSalt();</td></tr><tr class="hit"><td class="line">37</td><td class="hits">9</td><td class="source">    this.hashedPassword = this.encryptPassword(password);</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">  })</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">  .get(function() {</td></tr><tr class="miss"><td class="line">40</td><td class="hits">0</td><td class="source">    return this._password;</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source">// Public profile information</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">UserSchema</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  .virtual('profile')</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  .get(function() {</td></tr><tr class="miss"><td class="line">47</td><td class="hits">0</td><td class="source">    return {</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">      'name': this.name,</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">      'role': this.role</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">// Non-sensitive info we'll be putting in the token</td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">UserSchema</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  .virtual('token')</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  .get(function() {</td></tr><tr class="miss"><td class="line">57</td><td class="hits">0</td><td class="source">    return {</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">      '_id': this._id,</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">      'role': this.role</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">    };</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * Validations</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">// Validate username </td></tr><tr class="hit"><td class="line">68</td><td class="hits">1</td><td class="source">UserSchema</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">  .path('username')</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">  .validate(function(username) {</td></tr><tr class="hit"><td class="line">71</td><td class="hits">12</td><td class="source">    if (authTypes.indexOf(this.provider) !== -1) return true;</td></tr><tr class="hit"><td class="line">72</td><td class="hits">12</td><td class="source">    return username.length;</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">  }, 'Username cannot be blank');</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">// Validate username is letters, numbers, underscores, or dashes</td></tr><tr class="hit"><td class="line">76</td><td class="hits">1</td><td class="source">UserSchema</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">  .path('username')</td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">  .validate(function(username) {</td></tr><tr class="hit"><td class="line">79</td><td class="hits">12</td><td class="source">    var matches = username.match(/^[a-zA-Z0-9_.-]*$/);</td></tr><tr class="hit"><td class="line">80</td><td class="hits">12</td><td class="source">    return matches; </td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">  }, 'Username must be letters, numbers, underscores, or dashes');</td></tr><tr><td class="line">82</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">83</td><td class="hits"></td><td class="source">// Validate unhashed password length</td></tr><tr class="hit"><td class="line">84</td><td class="hits">1</td><td class="source">UserSchema.path('hashedPassword')</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">  .validate(function(v) {</td></tr><tr class="hit"><td class="line">86</td><td class="hits">12</td><td class="source">  if (this._password) {</td></tr><tr class="hit"><td class="line">87</td><td class="hits">11</td><td class="source">    if (this._password.length &lt; 5 || this._password.length &gt; 39) {</td></tr><tr class="hit"><td class="line">88</td><td class="hits">2</td><td class="source">      this.invalidate('password', 'Password must be between 5 and 39 characters.');</td></tr><tr><td class="line">89</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">    else{</td></tr><tr class="hit"><td class="line">92</td><td class="hits">1</td><td class="source">        this.invalidate('password', 'cannot be blank!!!!'); </td></tr><tr><td class="line">93</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">94</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">}, 'Password is INVALID' );</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">97</td><td class="hits"></td><td class="source">// Validate username is not taken</td></tr><tr class="hit"><td class="line">98</td><td class="hits">1</td><td class="source">UserSchema</td></tr><tr><td class="line">99</td><td class="hits"></td><td class="source">  .path('username')</td></tr><tr><td class="line">100</td><td class="hits"></td><td class="source">  .validate(function(value, respond) {</td></tr><tr class="hit"><td class="line">101</td><td class="hits">12</td><td class="source">    var self = this;</td></tr><tr class="hit"><td class="line">102</td><td class="hits">12</td><td class="source">    this.constructor.findOne({username: value}, function(err, user) {</td></tr><tr class="hit"><td class="line">103</td><td class="hits">12</td><td class="source">      if(err) throw err;</td></tr><tr class="hit"><td class="line">104</td><td class="hits">12</td><td class="source">      if(user) {</td></tr><tr class="hit"><td class="line">105</td><td class="hits">1</td><td class="source">        if(self.id === user.id) return respond(true);</td></tr><tr class="hit"><td class="line">106</td><td class="hits">1</td><td class="source">        return respond(false);</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">      }</td></tr><tr class="hit"><td class="line">108</td><td class="hits">11</td><td class="source">      respond(true);</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">}, 'The specified username is already in use.');</td></tr><tr><td class="line">111</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">112</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">113</td><td class="hits">1</td><td class="source">var validatePresenceOf = function(value) {</td></tr><tr class="hit"><td class="line">114</td><td class="hits">3</td><td class="source">  return value &amp;&amp; value.length;</td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source"> * Pre-save hook</td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">120</td><td class="hits">1</td><td class="source">UserSchema</td></tr><tr><td class="line">121</td><td class="hits"></td><td class="source">  .pre('save', function(next) {</td></tr><tr class="hit"><td class="line">122</td><td class="hits">3</td><td class="source">    if (!this.isNew) return next();</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">124</td><td class="hits">3</td><td class="source">    if (!validatePresenceOf(this.hashedPassword) &amp;&amp; authTypes.indexOf(this.provider) === -1)</td></tr><tr class="miss"><td class="line">125</td><td class="hits">0</td><td class="source">      next(new Error('Invalid password'));</td></tr><tr><td class="line">126</td><td class="hits"></td><td class="source">    else</td></tr><tr class="hit"><td class="line">127</td><td class="hits">3</td><td class="source">      next();</td></tr><tr><td class="line">128</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source"> * Methods</td></tr><tr><td class="line">132</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">133</td><td class="hits">1</td><td class="source">UserSchema.methods = {</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">   * Authenticate - check if the passwords are the same</td></tr><tr><td class="line">136</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">137</td><td class="hits"></td><td class="source">   * @param {String} plainText</td></tr><tr><td class="line">138</td><td class="hits"></td><td class="source">   * @return {Boolean}</td></tr><tr><td class="line">139</td><td class="hits"></td><td class="source">   * @api public</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">  authenticate: function(plainText) {</td></tr><tr class="hit"><td class="line">142</td><td class="hits">2</td><td class="source">    return this.encryptPassword(plainText) === this.hashedPassword;</td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">   * Make salt</td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">   * @return {String}</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source">   * @api public</td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">151</td><td class="hits"></td><td class="source">  makeSalt: function() {</td></tr><tr class="hit"><td class="line">152</td><td class="hits">9</td><td class="source">    return crypto.randomBytes(16).toString('base64');</td></tr><tr><td class="line">153</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">154</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">155</td><td class="hits"></td><td class="source">  /**</td></tr><tr><td class="line">156</td><td class="hits"></td><td class="source">   * Encrypt password</td></tr><tr><td class="line">157</td><td class="hits"></td><td class="source">   *</td></tr><tr><td class="line">158</td><td class="hits"></td><td class="source">   * @param {String} password</td></tr><tr><td class="line">159</td><td class="hits"></td><td class="source">   * @return {String}</td></tr><tr><td class="line">160</td><td class="hits"></td><td class="source">   * @api public</td></tr><tr><td class="line">161</td><td class="hits"></td><td class="source">   */</td></tr><tr><td class="line">162</td><td class="hits"></td><td class="source">  encryptPassword: function(password) {</td></tr><tr class="hit"><td class="line">163</td><td class="hits">11</td><td class="source">    if (!password || !this.salt) return '';</td></tr><tr class="hit"><td class="line">164</td><td class="hits">11</td><td class="source">    var salt = new Buffer(this.salt, 'base64');</td></tr><tr class="hit"><td class="line">165</td><td class="hits">11</td><td class="source">    return crypto.pbkdf2Sync(password, salt, 10000, 64).toString('base64');</td></tr><tr><td class="line">166</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">167</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">168</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">169</td><td class="hits">1</td><td class="source">module.exports = mongoose.model('User', UserSchema);</td></tr><tr><td class="line">170</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/api/user/user.model.spec.js">/Users/helenhan/ShareSound/server/api/user/user.model.spec.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">75</div><div class="hits">75</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var should = require('should');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var app = require('../../app');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var User = require('./user.model');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var supertest = require('supertest');</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var api = supertest('http://localhost:9000');</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">var expect = require('expect.js');</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">var user = new User({</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  provider: 'local',</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  username: 'Fake User',</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">  password: 'password'</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">describe('User Model', function() {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">1</td><td class="source">  before(function(done) {</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">    // Clear users before testing</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">    User.remove().exec().then(function() {</td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">      done();</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">  afterEach(function(done) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">12</td><td class="source">    User.remove().exec().then(function() {</td></tr><tr class="hit"><td class="line">27</td><td class="hits">12</td><td class="source">      done();</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">  it('should begin with no users', function(done) {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">1</td><td class="source">    User.find({}, function(err, users) {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">      users.should.have.length(0);</td></tr><tr class="hit"><td class="line">34</td><td class="hits">1</td><td class="source">      done();</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">  it('should fail when saving a duplicate user', function(done) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">    user.save(function() {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">      var userDup = new User(user);</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">      userDup.save(function(err) {</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">        should.exist(err);</td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">        done();</td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">48</td><td class="hits">1</td><td class="source">  it('should fail when saving without a username', function(done) {</td></tr><tr class="hit"><td class="line">49</td><td class="hits">1</td><td class="source">    user.username = '';</td></tr><tr class="hit"><td class="line">50</td><td class="hits">1</td><td class="source">    user.save(function(err) {</td></tr><tr class="hit"><td class="line">51</td><td class="hits">1</td><td class="source">      should.exist(err);</td></tr><tr class="hit"><td class="line">52</td><td class="hits">1</td><td class="source">      done();</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">    </td></tr><tr class="hit"><td class="line">56</td><td class="hits">1</td><td class="source"> it('should fail when saving username with invalid characters (not numbers, letters, dashes, underscores)', function(done) {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">1</td><td class="source">    user.username = 'this!is#````bad';</td></tr><tr class="hit"><td class="line">58</td><td class="hits">1</td><td class="source">    user.save(function(err) {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">      should.exist(err);</td></tr><tr class="hit"><td class="line">60</td><td class="hits">1</td><td class="source">      done();</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">64</td><td class="hits">1</td><td class="source">it(&quot;should authenticate user if password is valid&quot;, function() {</td></tr><tr class="hit"><td class="line">65</td><td class="hits">1</td><td class="source">    return user.authenticate('password').should.be.true;</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">68</td><td class="hits">1</td><td class="source">it('should fail saving password that is too short)', function(done) {</td></tr><tr class="hit"><td class="line">69</td><td class="hits">1</td><td class="source">    user.password = '123';</td></tr><tr class="hit"><td class="line">70</td><td class="hits">1</td><td class="source">    user.save(function(err) {</td></tr><tr class="hit"><td class="line">71</td><td class="hits">1</td><td class="source">      should.exist(err);</td></tr><tr class="hit"><td class="line">72</td><td class="hits">1</td><td class="source">      done();</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">  </td></tr><tr class="hit"><td class="line">77</td><td class="hits">1</td><td class="source">  it(&quot;should not authenticate user if password is invalid&quot;, function() {</td></tr><tr class="hit"><td class="line">78</td><td class="hits">1</td><td class="source">    return user.authenticate('blah').should.not.be.true;</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source">    </td></tr><tr><td class="line">81</td><td class="hits"></td><td class="source">   </td></tr><tr class="hit"><td class="line">82</td><td class="hits">1</td><td class="source">   it('will create user through post request', function(done){</td></tr><tr class="hit"><td class="line">83</td><td class="hits">1</td><td class="source">    api.post('/api/users')</td></tr><tr><td class="line">84</td><td class="hits"></td><td class="source">      .send({ username: 'cooluser', password: '123123'})</td></tr><tr><td class="line">85</td><td class="hits"></td><td class="source">      .end(function(e,res){</td></tr><tr class="hit"><td class="line">86</td><td class="hits">1</td><td class="source">        console.log(res.body)</td></tr><tr class="hit"><td class="line">87</td><td class="hits">1</td><td class="source">        expect(e).to.eql(null)</td></tr><tr class="hit"><td class="line">88</td><td class="hits">1</td><td class="source">        expect(res.body['status code']).to.eql(1)</td></tr><tr class="hit"><td class="line">89</td><td class="hits">1</td><td class="source">        done()</td></tr><tr><td class="line">90</td><td class="hits"></td><td class="source">      }); </td></tr><tr><td class="line">91</td><td class="hits"></td><td class="source">   });</td></tr><tr><td class="line">92</td><td class="hits"></td><td class="source">    </td></tr><tr class="hit"><td class="line">93</td><td class="hits">1</td><td class="source">  it('will create blank user through post request', function(done){</td></tr><tr class="hit"><td class="line">94</td><td class="hits">1</td><td class="source">    api.post('/api/users')</td></tr><tr><td class="line">95</td><td class="hits"></td><td class="source">      .send({ username: '', password: '123123'})</td></tr><tr><td class="line">96</td><td class="hits"></td><td class="source">      .end(function(e,res){</td></tr><tr class="hit"><td class="line">97</td><td class="hits">1</td><td class="source">        console.log(res.body)</td></tr><tr class="hit"><td class="line">98</td><td class="hits">1</td><td class="source">        expect(e).to.eql(null)</td></tr><tr class="hit"><td class="line">99</td><td class="hits">1</td><td class="source">        expect(res.body['status code']).to.eql(-2)</td></tr><tr class="hit"><td class="line">100</td><td class="hits">1</td><td class="source">        done()</td></tr><tr><td class="line">101</td><td class="hits"></td><td class="source">      }); </td></tr><tr><td class="line">102</td><td class="hits"></td><td class="source">   });</td></tr><tr><td class="line">103</td><td class="hits"></td><td class="source">    </td></tr><tr class="hit"><td class="line">104</td><td class="hits">1</td><td class="source">   it('will create duplicate user', function(done){</td></tr><tr class="hit"><td class="line">105</td><td class="hits">1</td><td class="source">    api.post('/api/users')</td></tr><tr><td class="line">106</td><td class="hits"></td><td class="source">      .send({ username: 'notspecial', password: '123123'})</td></tr><tr><td class="line">107</td><td class="hits"></td><td class="source">      .end(function(e, res){</td></tr><tr class="hit"><td class="line">108</td><td class="hits">1</td><td class="source">          api.post('/api/users')</td></tr><tr><td class="line">109</td><td class="hits"></td><td class="source">          .send({ username: 'notspecial', password: '123123'})</td></tr><tr><td class="line">110</td><td class="hits"></td><td class="source">            .end(function(e,res){</td></tr><tr class="hit"><td class="line">111</td><td class="hits">1</td><td class="source">            console.log(res.body)</td></tr><tr class="hit"><td class="line">112</td><td class="hits">1</td><td class="source">            expect(e).to.eql(null)</td></tr><tr class="hit"><td class="line">113</td><td class="hits">1</td><td class="source">            expect(res.body['status code']).to.eql(-1)</td></tr><tr class="hit"><td class="line">114</td><td class="hits">1</td><td class="source">            done(); </td></tr><tr><td class="line">115</td><td class="hits"></td><td class="source">      }); </td></tr><tr><td class="line">116</td><td class="hits"></td><td class="source">          </td></tr><tr><td class="line">117</td><td class="hits"></td><td class="source">      }); </td></tr><tr><td class="line">118</td><td class="hits"></td><td class="source">    </td></tr><tr><td class="line">119</td><td class="hits"></td><td class="source">   });</td></tr><tr><td class="line">120</td><td class="hits"></td><td class="source">    </td></tr><tr class="hit"><td class="line">121</td><td class="hits">1</td><td class="source">   it('will create user with too short password through post request', function(done){</td></tr><tr class="hit"><td class="line">122</td><td class="hits">1</td><td class="source">    api.post('/api/users')</td></tr><tr><td class="line">123</td><td class="hits"></td><td class="source">      .send({ username: 'tooshort', password: '123'})</td></tr><tr><td class="line">124</td><td class="hits"></td><td class="source">      .end(function(e,res){</td></tr><tr class="hit"><td class="line">125</td><td class="hits">1</td><td class="source">        console.log(res.body)</td></tr><tr class="hit"><td class="line">126</td><td class="hits">1</td><td class="source">        expect(e).to.eql(null)</td></tr><tr class="hit"><td class="line">127</td><td class="hits">1</td><td class="source">        expect(res.body['status code']).to.eql(-3)</td></tr><tr class="hit"><td class="line">128</td><td class="hits">1</td><td class="source">        done()</td></tr><tr><td class="line">129</td><td class="hits"></td><td class="source">      }); </td></tr><tr><td class="line">130</td><td class="hits"></td><td class="source">   });</td></tr><tr><td class="line">131</td><td class="hits"></td><td class="source">    </td></tr><tr class="hit"><td class="line">132</td><td class="hits">1</td><td class="source">    it('will create user with bad characters in username through post request', function(done){</td></tr><tr class="hit"><td class="line">133</td><td class="hits">1</td><td class="source">    api.post('/api/users')</td></tr><tr><td class="line">134</td><td class="hits"></td><td class="source">      .send({ username: 'John Doe!', password: '123123'})</td></tr><tr><td class="line">135</td><td class="hits"></td><td class="source">      .end(function(e,res){</td></tr><tr class="hit"><td class="line">136</td><td class="hits">1</td><td class="source">        console.log(res.body)</td></tr><tr class="hit"><td class="line">137</td><td class="hits">1</td><td class="source">        expect(e).to.eql(null)</td></tr><tr class="hit"><td class="line">138</td><td class="hits">1</td><td class="source">        expect(res.body['status code']).to.eql(-2)</td></tr><tr class="hit"><td class="line">139</td><td class="hits">1</td><td class="source">        done()</td></tr><tr><td class="line">140</td><td class="hits"></td><td class="source">      }); </td></tr><tr><td class="line">141</td><td class="hits"></td><td class="source">   });</td></tr><tr><td class="line">142</td><td class="hits"></td><td class="source">    </td></tr><tr><td class="line">143</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">144</td><td class="hits"></td><td class="source">    </td></tr><tr><td class="line">145</td><td class="hits"></td><td class="source">    </td></tr><tr><td class="line">146</td><td class="hits"></td><td class="source">    </td></tr><tr><td class="line">147</td><td class="hits"></td><td class="source">    </td></tr><tr><td class="line">148</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">149</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">150</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/app.js">/Users/helenhan/ShareSound/server/app.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">15</div><div class="hits">15</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Main application file</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">// Set default node environment to development</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">process.env.NODE_ENV = process.env.NODE_ENV || 'development';</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">var express = require('express');</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">var mongoose = require('mongoose');</td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var config = require('./config/environment');</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">var bodyParser = require('body-parser');</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">// Connect to database</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">mongoose.connect(config.mongo.uri, config.mongo.options);</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">// Populate DB with sample data</td></tr><tr class="hit"><td class="line">19</td><td class="hits">2</td><td class="source">if(config.seedDB) { require('./config/seed'); }</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">// Setup server</td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">var app = express();</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">var server = require('http').createServer(app);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">require('./config/express')(app);</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">require('./routes')(app);</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">// Start server</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">server.listen(config.port, config.ip, function () {</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">  console.log('Express server listening on %d, in %s mode', config.port, app.get('env'));</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">// Expose app</td></tr><tr class="hit"><td class="line">33</td><td class="hits">1</td><td class="source">exports = module.exports = app;</td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/auth/auth.service.js">/Users/helenhan/ShareSound/server/auth/auth.service.js</h2><div id="stats" class="medium"><div class="percentage">55%</div><div class="sloc">36</div><div class="hits">20</div><div class="misses">16</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var mongoose = require('mongoose');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var passport = require('passport');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var config = require('../config/environment');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var jwt = require('jsonwebtoken');</td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var expressJwt = require('express-jwt');</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">var compose = require('composable-middleware');</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">var User = require('../api/user/user.model');</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">var validateJwt = expressJwt({ secret: config.secrets.session });</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> * Attaches the user object to the request if authenticated</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> * Otherwise returns 403</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">function isAuthenticated() {</td></tr><tr class="hit"><td class="line">17</td><td class="hits">2</td><td class="source">  return compose()</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    // Validate jwt</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">    .use(function(req, res, next) {</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">      // allow access_token to be passed through query parameter as well</td></tr><tr class="miss"><td class="line">21</td><td class="hits">0</td><td class="source">      if(req.query &amp;&amp; req.query.hasOwnProperty('access_token')) {</td></tr><tr class="miss"><td class="line">22</td><td class="hits">0</td><td class="source">        req.headers.authorization = 'Bearer ' + req.query.access_token;</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">      }</td></tr><tr class="miss"><td class="line">24</td><td class="hits">0</td><td class="source">      validateJwt(req, res, next);</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    })</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">    // Attach user to request</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">    .use(function(req, res, next) {</td></tr><tr class="miss"><td class="line">28</td><td class="hits">0</td><td class="source">      User.findById(req.user._id, function (err, user) {</td></tr><tr class="miss"><td class="line">29</td><td class="hits">0</td><td class="source">        if (err) return next(err);</td></tr><tr class="miss"><td class="line">30</td><td class="hits">0</td><td class="source">        if (!user) return res.send(401);</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">32</td><td class="hits">0</td><td class="source">        req.user = user;</td></tr><tr class="miss"><td class="line">33</td><td class="hits">0</td><td class="source">        next();</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source"> * Checks if the user role meets the minimum requirements of the route</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">function hasRole(roleRequired) {</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">  if (!roleRequired) throw new Error('Required role needs to be set');</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">  return compose()</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    .use(isAuthenticated())</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    .use(function meetsRequirements(req, res, next) {</td></tr><tr class="miss"><td class="line">47</td><td class="hits">0</td><td class="source">      if (config.userRoles.indexOf(req.user.role) &gt;= config.userRoles.indexOf(roleRequired)) {</td></tr><tr class="miss"><td class="line">48</td><td class="hits">0</td><td class="source">        next();</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">      else {</td></tr><tr class="miss"><td class="line">51</td><td class="hits">0</td><td class="source">        res.send(403);</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source"> * Returns a jwt token signed by the app secret</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">59</td><td class="hits">1</td><td class="source">function signToken(id) {</td></tr><tr class="miss"><td class="line">60</td><td class="hits">0</td><td class="source">  return jwt.sign({ _id: id }, config.secrets.session, { expiresInMinutes: 60*5 });</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source"> * Set token cookie directly for oAuth strategies</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source"> */</td></tr><tr class="hit"><td class="line">66</td><td class="hits">1</td><td class="source">function setTokenCookie(req, res) {</td></tr><tr class="miss"><td class="line">67</td><td class="hits">0</td><td class="source">  if (!req.user) return res.json(404, { message: 'Something went wrong, please try again.'});</td></tr><tr class="miss"><td class="line">68</td><td class="hits">0</td><td class="source">  var token = signToken(req.user._id, req.user.role);</td></tr><tr class="miss"><td class="line">69</td><td class="hits">0</td><td class="source">  res.cookie('token', JSON.stringify(token));</td></tr><tr class="miss"><td class="line">70</td><td class="hits">0</td><td class="source">  res.redirect('/');</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">73</td><td class="hits">1</td><td class="source">exports.isAuthenticated = isAuthenticated;</td></tr><tr class="hit"><td class="line">74</td><td class="hits">1</td><td class="source">exports.hasRole = hasRole;</td></tr><tr class="hit"><td class="line">75</td><td class="hits">1</td><td class="source">exports.signToken = signToken;</td></tr><tr class="hit"><td class="line">76</td><td class="hits">1</td><td class="source">exports.setTokenCookie = setTokenCookie;</td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/auth/facebook/index.js">/Users/helenhan/ShareSound/server/auth/facebook/index.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">7</div><div class="hits">7</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var express = require('express');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var passport = require('passport');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var auth = require('../auth.service');</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var router = express.Router();</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">router</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">  .get('/', passport.authenticate('facebook', {</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    scope: ['email', 'user_about_me'],</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">    failureRedirect: '/signup',</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">    session: false</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">  }))</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  .get('/callback', passport.authenticate('facebook', {</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">    failureRedirect: '/signup',</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    session: false</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  }), auth.setTokenCookie);</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">module.exports = router;</td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/auth/facebook/passport.js">/Users/helenhan/ShareSound/server/auth/facebook/passport.js</h2><div id="stats" class="low"><div class="percentage">30%</div><div class="sloc">13</div><div class="hits">4</div><div class="misses">9</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var passport = require('passport');</td></tr><tr class="hit"><td class="line">2</td><td class="hits">1</td><td class="source">var FacebookStrategy = require('passport-facebook').Strategy;</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">exports.setup = function (User, config) {</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">  passport.use(new FacebookStrategy({</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">      clientID: config.facebook.clientID,</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">      clientSecret: config.facebook.clientSecret,</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">      callbackURL: config.facebook.callbackURL</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source">    function(accessToken, refreshToken, profile, done) {</td></tr><tr class="miss"><td class="line">11</td><td class="hits">0</td><td class="source">      User.findOne({</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">        'facebook.id': profile.id</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">      },</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">      function(err, user) {</td></tr><tr class="miss"><td class="line">15</td><td class="hits">0</td><td class="source">        if (err) {</td></tr><tr class="miss"><td class="line">16</td><td class="hits">0</td><td class="source">          return done(err);</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">        }</td></tr><tr class="miss"><td class="line">18</td><td class="hits">0</td><td class="source">        if (!user) {</td></tr><tr class="miss"><td class="line">19</td><td class="hits">0</td><td class="source">          user = new User({</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">            name: profile.displayName,</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">            email: profile.emails[0].value,</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">            role: 'user',</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">            username: profile.username,</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">            provider: 'facebook',</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">            facebook: profile._json</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">          });</td></tr><tr class="miss"><td class="line">27</td><td class="hits">0</td><td class="source">          user.save(function(err) {</td></tr><tr class="miss"><td class="line">28</td><td class="hits">0</td><td class="source">            if (err) done(err);</td></tr><tr class="miss"><td class="line">29</td><td class="hits">0</td><td class="source">            return done(err, user);</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">          });</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">        } else {</td></tr><tr class="miss"><td class="line">32</td><td class="hits">0</td><td class="source">          return done(err, user);</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">        }</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source">      })</td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  ));</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/auth/index.js">/Users/helenhan/ShareSound/server/auth/index.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">11</div><div class="hits">11</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var express = require('express');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var passport = require('passport');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var config = require('../config/environment');</td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">var User = require('../api/user/user.model');</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">// Passport Configuration</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">require('./local/passport').setup(User, config);</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">require('./facebook/passport').setup(User, config);</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var router = express.Router();</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">router.use('/local', require('./local'));</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">router.use('/facebook', require('./facebook'));</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">module.exports = router;</td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/auth/local/index.js">/Users/helenhan/ShareSound/server/auth/local/index.js</h2><div id="stats" class="medium"><div class="percentage">53%</div><div class="sloc">13</div><div class="hits">7</div><div class="misses">6</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var express = require('express');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var passport = require('passport');</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">var auth = require('../auth.service');</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var router = express.Router();</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">router.post('/', function(req, res, next) {</td></tr><tr class="miss"><td class="line">10</td><td class="hits">0</td><td class="source">  passport.authenticate('local', function (err, user, info) {</td></tr><tr class="miss"><td class="line">11</td><td class="hits">0</td><td class="source">    var error = err || info;</td></tr><tr class="miss"><td class="line">12</td><td class="hits">0</td><td class="source">    if (error) return res.json(401, error);</td></tr><tr class="miss"><td class="line">13</td><td class="hits">0</td><td class="source">    if (!user) return res.json(404, {message: 'Something went wrong, please try again.'});</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">15</td><td class="hits">0</td><td class="source">    var token = auth.signToken(user._id, user.role);</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    //res.json({token: token});</td></tr><tr class="miss"><td class="line">17</td><td class="hits">0</td><td class="source">    res.json({&quot;status code&quot; : 1, token: token}); </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  })(req, res, next)</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">21</td><td class="hits">1</td><td class="source">module.exports = router;</td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/auth/local/passport.js">/Users/helenhan/ShareSound/server/auth/local/passport.js</h2><div id="stats" class="low"><div class="percentage">36%</div><div class="sloc">11</div><div class="hits">4</div><div class="misses">7</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">var passport = require('passport');</td></tr><tr class="hit"><td class="line">2</td><td class="hits">1</td><td class="source">var LocalStrategy = require('passport-local').Strategy;</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">exports.setup = function (User, config) {</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">  passport.use(new LocalStrategy({</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">      usernameField: 'username',</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">      passwordField: 'password' // this is the virtual field on the model</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">    function(username, password, done) {</td></tr><tr class="miss"><td class="line">10</td><td class="hits">0</td><td class="source">      User.findOne({</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">        username: username.toLowerCase()</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">      }, function(err, user) {</td></tr><tr class="miss"><td class="line">13</td><td class="hits">0</td><td class="source">        if (err) return done(err);</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">15</td><td class="hits">0</td><td class="source">        if (!user) {</td></tr><tr class="miss"><td class="line">16</td><td class="hits">0</td><td class="source">          return done(null, false, {&quot;status code&quot;: -1,  message: 'This username is not registered.' });</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">        }</td></tr><tr class="miss"><td class="line">18</td><td class="hits">0</td><td class="source">        if (!user.authenticate(password)) {</td></tr><tr class="miss"><td class="line">19</td><td class="hits">0</td><td class="source">          return done(null, false, {&quot;status code&quot;: -1, message: 'This password is not correct.' });</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">        }</td></tr><tr class="miss"><td class="line">21</td><td class="hits">0</td><td class="source">        return done(null, user);</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">      });</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  ));</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/components/errors/index.js">/Users/helenhan/ShareSound/server/components/errors/index.js</h2><div id="stats" class="terrible"><div class="percentage">22%</div><div class="sloc">9</div><div class="hits">2</div><div class="misses">7</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Error responses</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">module.exports[404] = function pageNotFound(req, res) {</td></tr><tr class="miss"><td class="line">8</td><td class="hits">0</td><td class="source">  var viewFilePath = '404';</td></tr><tr class="miss"><td class="line">9</td><td class="hits">0</td><td class="source">  var statusCode = 404;</td></tr><tr class="miss"><td class="line">10</td><td class="hits">0</td><td class="source">  var result = {</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">    status: statusCode</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  };</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">14</td><td class="hits">0</td><td class="source">  res.status(result.status);</td></tr><tr class="miss"><td class="line">15</td><td class="hits">0</td><td class="source">  res.render(viewFilePath, function (err) {</td></tr><tr class="miss"><td class="line">16</td><td class="hits">0</td><td class="source">    if (err) { return res.json(result, result.status); }</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr class="miss"><td class="line">18</td><td class="hits">0</td><td class="source">    res.render(viewFilePath);</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/config/environment/development.js">/Users/helenhan/ShareSound/server/config/environment/development.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">2</div><div class="hits">2</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source">// Development specific configuration</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source">// ==================================</td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">module.exports = {</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source">  // MongoDB connection options</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source">  mongo: {</td></tr><tr><td class="line">8</td><td class="hits"></td><td class="source">    uri: 'mongodb://localhost/sharesound-dev'</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">10</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">  seedDB: true</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/config/environment/index.js">/Users/helenhan/ShareSound/server/config/environment/index.js</h2><div id="stats" class="medium"><div class="percentage">66%</div><div class="sloc">9</div><div class="hits">6</div><div class="misses">3</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr class="hit"><td class="line">1</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">3</td><td class="hits">1</td><td class="source">var path = require('path');</td></tr><tr class="hit"><td class="line">4</td><td class="hits">1</td><td class="source">var _ = require('lodash');</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">function requiredProcessEnv(name) {</td></tr><tr class="miss"><td class="line">7</td><td class="hits">0</td><td class="source">  if(!process.env[name]) {</td></tr><tr class="miss"><td class="line">8</td><td class="hits">0</td><td class="source">    throw new Error('You must set the ' + name + ' environment variable');</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source">  }</td></tr><tr class="miss"><td class="line">10</td><td class="hits">0</td><td class="source">  return process.env[name];</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source">}</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">13</td><td class="hits"></td><td class="source">// All configurations will extend these options</td></tr><tr><td class="line">14</td><td class="hits"></td><td class="source">// ============================================</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var all = {</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">  env: process.env.NODE_ENV,</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  // Root path of server</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  root: path.normalize(__dirname + '/../../..'),</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">  // Server port</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">  port: process.env.PORT || 9000,</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">  // Should we populate the DB with sample data?</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">  seedDB: true,</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">  // Secret for session, you will want to change this and make it an environment variable</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">  secrets: {</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">    session: 'share-sound-secret'</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  // List of user roles</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">  userRoles: ['guest', 'user', 'admin'],</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">35</td><td class="hits"></td><td class="source">  // MongoDB connection options</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  mongo: {</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source">    options: {</td></tr><tr><td class="line">38</td><td class="hits"></td><td class="source">      db: {</td></tr><tr><td class="line">39</td><td class="hits"></td><td class="source">        safe: true</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">      }</td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">43</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">44</td><td class="hits"></td><td class="source">  facebook: {</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">    clientID:     process.env.FACEBOOK_ID || 'id',</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">    clientSecret: process.env.FACEBOOK_SECRET || 'secret',</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">    callbackURL:  (process.env.DOMAIN || '') + '/auth/facebook/callback'</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">  },</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">// Export the config object based on the NODE_ENV</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">// ==============================================</td></tr><tr class="hit"><td class="line">54</td><td class="hits">1</td><td class="source">module.exports = _.merge(</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">  all,</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">  require('./' + process.env.NODE_ENV + '.js') || {});</td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/config/express.js">/Users/helenhan/ShareSound/server/config/express.js</h2><div id="stats" class="high"><div class="percentage">88%</div><div class="sloc">35</div><div class="hits">31</div><div class="misses">4</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Express configuration</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">5</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">6</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">7</td><td class="hits">1</td><td class="source">var express = require('express');</td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">var favicon = require('serve-favicon');</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">var morgan = require('morgan');</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">var compression = require('compression');</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">var bodyParser = require('body-parser');</td></tr><tr class="hit"><td class="line">12</td><td class="hits">1</td><td class="source">var methodOverride = require('method-override');</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">var cookieParser = require('cookie-parser');</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">var errorHandler = require('errorhandler');</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">var path = require('path');</td></tr><tr class="hit"><td class="line">16</td><td class="hits">1</td><td class="source">var config = require('./environment');</td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">var passport = require('passport');</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">19</td><td class="hits">1</td><td class="source">module.exports = function(app) {</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">  var env = app.get('env');</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">22</td><td class="hits">1</td><td class="source">  app.set('views', config.root + '/server/views');</td></tr><tr class="hit"><td class="line">23</td><td class="hits">1</td><td class="source">  app.engine('html', require('ejs').renderFile);</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">  app.set('view engine', 'html');</td></tr><tr class="hit"><td class="line">25</td><td class="hits">1</td><td class="source">  app.use(compression());</td></tr><tr class="hit"><td class="line">26</td><td class="hits">1</td><td class="source">  app.use(bodyParser.urlencoded({ extended: true }));</td></tr><tr class="hit"><td class="line">27</td><td class="hits">1</td><td class="source">  app.use(bodyParser.json());</td></tr><tr class="hit"><td class="line">28</td><td class="hits">1</td><td class="source">  app.use(methodOverride());</td></tr><tr class="hit"><td class="line">29</td><td class="hits">1</td><td class="source">  app.use(cookieParser());</td></tr><tr class="hit"><td class="line">30</td><td class="hits">1</td><td class="source">  app.use(passport.initialize());</td></tr><tr class="hit"><td class="line">31</td><td class="hits">1</td><td class="source">  if ('production' === env) {</td></tr><tr class="miss"><td class="line">32</td><td class="hits">0</td><td class="source">    app.use(favicon(path.join(config.root, 'public', 'favicon.ico')));</td></tr><tr class="miss"><td class="line">33</td><td class="hits">0</td><td class="source">    app.use(express.static(path.join(config.root, 'public')));</td></tr><tr class="miss"><td class="line">34</td><td class="hits">0</td><td class="source">    app.set('appPath', config.root + '/public');</td></tr><tr class="miss"><td class="line">35</td><td class="hits">0</td><td class="source">    app.use(morgan('dev'));</td></tr><tr><td class="line">36</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">37</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">  if ('development' === env || 'test' === env) {</td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">    app.use(require('connect-livereload')());</td></tr><tr class="hit"><td class="line">40</td><td class="hits">1</td><td class="source">    app.use(express.static(path.join(config.root, '.tmp')));</td></tr><tr class="hit"><td class="line">41</td><td class="hits">1</td><td class="source">    app.use(express.static(path.join(config.root, 'client')));</td></tr><tr class="hit"><td class="line">42</td><td class="hits">1</td><td class="source">    app.set('appPath', 'client');</td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">    app.use(morgan('dev'));</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">    app.use(errorHandler()); // Error handler - has to be last</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source">  }</td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">};</td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/config/seed.js">/Users/helenhan/ShareSound/server/config/seed.js</h2><div id="stats" class="high"><div class="percentage">100%</div><div class="sloc">14</div><div class="hits">14</div><div class="misses">0</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source"> * Populate DB with sample data on server start</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * to disable, edit config/environment/index.js, and set `seedDB: false`</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">var Thing = require('../api/thing/thing.model');</td></tr><tr class="hit"><td class="line">9</td><td class="hits">1</td><td class="source">var User = require('../api/user/user.model');</td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">var Track = require('../api/track/track.model');</td></tr><tr class="hit"><td class="line">11</td><td class="hits">1</td><td class="source">var mongoose = require('mongoose');</td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">Thing.find({}).remove(function() {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">  Thing.create({</td></tr><tr><td class="line">15</td><td class="hits"></td><td class="source">    name : 'Development Tools',</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source">    info : 'Integration with popular tools such as Bower, Grunt, Karma, Mocha, JSHint, Node Inspector, Livereload, Protractor, Jade, Stylus, Sass, CoffeeScript, and Less.'</td></tr><tr><td class="line">17</td><td class="hits"></td><td class="source">  }, {</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">    name : 'Server and Client integration',</td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">    info : 'Built with a powerful and fun stack: MongoDB, Express, AngularJS, and Node.'</td></tr><tr><td class="line">20</td><td class="hits"></td><td class="source">  }, {</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">    name : 'Smart Build System',</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source">    info : 'Build system ignores `spec` files, allowing you to keep tests alongside code. Automatic injection of scripts and styles into your index.html'</td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  },  {</td></tr><tr><td class="line">24</td><td class="hits"></td><td class="source">    name : 'Modular Structure',</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    info : 'Best practice client and server structures allow for more code reusability and maximum scalability'</td></tr><tr><td class="line">26</td><td class="hits"></td><td class="source">  },  {</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">    name : 'Optimized Build',</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">    info : 'Build process packs up your templates as a single JavaScript payload, minifies your scripts/css/images, and rewrites asset names for caching.'</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source">  },{</td></tr><tr><td class="line">30</td><td class="hits"></td><td class="source">    name : 'Deployment Ready',</td></tr><tr><td class="line">31</td><td class="hits"></td><td class="source">    info : 'Easily deploy your app to Heroku or Openshift with the heroku and openshift subgenerators'</td></tr><tr><td class="line">32</td><td class="hits"></td><td class="source">  });</td></tr><tr><td class="line">33</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">34</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">35</td><td class="hits">1</td><td class="source">User.find({}).remove(function() {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">1</td><td class="source">  var newUser = new User({username: &quot;test&quot;, password: &quot;123123&quot;});</td></tr><tr class="hit"><td class="line">37</td><td class="hits">1</td><td class="source">  var id = mongoose.Types.ObjectId(&quot;DDDDDDDDDDDD&quot;);</td></tr><tr class="hit"><td class="line">38</td><td class="hits">1</td><td class="source">  newUser._id = id; </td></tr><tr class="hit"><td class="line">39</td><td class="hits">1</td><td class="source">  newUser.save(function(err, user){</td></tr><tr><td class="line">40</td><td class="hits"></td><td class="source">  }); </td></tr><tr><td class="line">41</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">42</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">43</td><td class="hits">1</td><td class="source">Track.find({}).remove(function() {</td></tr><tr class="hit"><td class="line">44</td><td class="hits">1</td><td class="source">    Track.create({</td></tr><tr><td class="line">45</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">46</td><td class="hits"></td><td class="source">        name: &quot;Wareru9&quot;,</td></tr><tr><td class="line">47</td><td class="hits"></td><td class="source">        // url: &quot;http://helenhan.me/Prefontaine.mp3&quot;,</td></tr><tr><td class="line">48</td><td class="hits"></td><td class="source">        url: 'https://sharesound.s3.amazonaws.com/wareru9.mp3',</td></tr><tr><td class="line">49</td><td class="hits"></td><td class="source">        uploader_id: &quot;444444444444444444444444&quot;, </td></tr><tr><td class="line">50</td><td class="hits"></td><td class="source">    }, {</td></tr><tr><td class="line">51</td><td class="hits"></td><td class="source">        name: &quot;Wind Dark&quot;,</td></tr><tr><td class="line">52</td><td class="hits"></td><td class="source">        // url: &quot;https://dl-web.dropbox.com/get/tracks%20example/Endlos.mp3?_subject_uid=106468574&amp;w=AADQGY5UDoqKKDUwZlds_OJbbtrZ6bMeItcLqaA9tiMxTQ&quot;,</td></tr><tr><td class="line">53</td><td class="hits"></td><td class="source">        url: 'https://sharesound.s3.amazonaws.com/wind_dark.mp3',</td></tr><tr><td class="line">54</td><td class="hits"></td><td class="source">        uploader_id: &quot;444444444444444444444444&quot;</td></tr><tr><td class="line">55</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">56</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">57</td><td class="hits"></td><td class="source">        name: &quot;Horror Gyaku&quot;,</td></tr><tr><td class="line">58</td><td class="hits"></td><td class="source">        // url: &quot;https://dl-web.dropbox.com/get/tracks%20example/Endlos.mp3?_subject_uid=106468574&amp;w=AADQGY5UDoqKKDUwZlds_OJbbtrZ6bMeItcLqaA9tiMxTQ&quot;,</td></tr><tr><td class="line">59</td><td class="hits"></td><td class="source">        url: 'https://sharesound.s3.amazonaws.com/horror2_gyaku3.wav',</td></tr><tr><td class="line">60</td><td class="hits"></td><td class="source">        uploader_id: &quot;444444444444444444444444&quot;</td></tr><tr><td class="line">61</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">62</td><td class="hits"></td><td class="source">    {</td></tr><tr><td class="line">63</td><td class="hits"></td><td class="source">        name: &quot;Lost Chair&quot;,</td></tr><tr><td class="line">64</td><td class="hits"></td><td class="source">        // url: &quot;https://dl-web.dropbox.com/get/tracks%20example/Endlos.mp3?_subject_uid=106468574&amp;w=AADQGY5UDoqKKDUwZlds_OJbbtrZ6bMeItcLqaA9tiMxTQ&quot;,</td></tr><tr><td class="line">65</td><td class="hits"></td><td class="source">        url: 'https://sharesound.s3.amazonaws.com/Lost_Chair.mp3',</td></tr><tr><td class="line">66</td><td class="hits"></td><td class="source">        uploader_id: &quot;444444444444444444444444&quot;</td></tr><tr><td class="line">67</td><td class="hits"></td><td class="source">    },</td></tr><tr><td class="line">68</td><td class="hits"></td><td class="source">     {</td></tr><tr><td class="line">69</td><td class="hits"></td><td class="source">        name: &quot;Rumor&quot;,</td></tr><tr><td class="line">70</td><td class="hits"></td><td class="source">        // url: &quot;https://dl-web.dropbox.com/get/tracks%20example/Endlos.mp3?_subject_uid=106468574&amp;w=AADQGY5UDoqKKDUwZlds_OJbbtrZ6bMeItcLqaA9tiMxTQ&quot;,</td></tr><tr><td class="line">71</td><td class="hits"></td><td class="source">        url: 'https://sharesound.s3.amazonaws.com/Rumor.ogg',</td></tr><tr><td class="line">72</td><td class="hits"></td><td class="source">        uploader_id: &quot;444444444444444444444444&quot;</td></tr><tr><td class="line">73</td><td class="hits"></td><td class="source">    }</td></tr><tr><td class="line">74</td><td class="hits"></td><td class="source">       </td></tr><tr><td class="line">75</td><td class="hits"></td><td class="source">            </td></tr><tr><td class="line">76</td><td class="hits"></td><td class="source">                </td></tr><tr><td class="line">77</td><td class="hits"></td><td class="source">                </td></tr><tr><td class="line">78</td><td class="hits"></td><td class="source">    );</td></tr><tr><td class="line">79</td><td class="hits"></td><td class="source">});</td></tr><tr><td class="line">80</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div><div class="file"><h2 id="/Users/helenhan/ShareSound/server/routes.js">/Users/helenhan/ShareSound/server/routes.js</h2><div id="stats" class="high"><div class="percentage">90%</div><div class="sloc">10</div><div class="hits">9</div><div class="misses">1</div></div><table id="source"><thead><tr><th>Line</th><th>Hits</th><th>Source</th></tr></thead><tbody><tr><td class="line">1</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">2</td><td class="hits"></td><td class="source">/**</td></tr><tr><td class="line">3</td><td class="hits"></td><td class="source"> * Main application routes</td></tr><tr><td class="line">4</td><td class="hits"></td><td class="source"> */</td></tr><tr><td class="line">5</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">6</td><td class="hits">1</td><td class="source">'use strict';</td></tr><tr><td class="line">7</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">8</td><td class="hits">1</td><td class="source">var errors = require('./components/errors');</td></tr><tr><td class="line">9</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">10</td><td class="hits">1</td><td class="source">module.exports = function(app) {</td></tr><tr><td class="line">11</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">12</td><td class="hits"></td><td class="source">  // Insert routes below</td></tr><tr class="hit"><td class="line">13</td><td class="hits">1</td><td class="source">  app.use('/api/tracks', require('./api/track'));</td></tr><tr class="hit"><td class="line">14</td><td class="hits">1</td><td class="source">  app.use('/api/things', require('./api/thing'));</td></tr><tr class="hit"><td class="line">15</td><td class="hits">1</td><td class="source">  app.use('/api/users', require('./api/user'));</td></tr><tr><td class="line">16</td><td class="hits"></td><td class="source"> </td></tr><tr class="hit"><td class="line">17</td><td class="hits">1</td><td class="source">  app.use('/auth', require('./auth'));</td></tr><tr><td class="line">18</td><td class="hits"></td><td class="source">  </td></tr><tr><td class="line">19</td><td class="hits"></td><td class="source">  // All undefined asset or api routes should return a 404</td></tr><tr class="hit"><td class="line">20</td><td class="hits">1</td><td class="source">  app.route('/:url(api|auth|components|app|bower_components|assets)/*')</td></tr><tr><td class="line">21</td><td class="hits"></td><td class="source">   .get(errors[404]);</td></tr><tr><td class="line">22</td><td class="hits"></td><td class="source"> </td></tr><tr><td class="line">23</td><td class="hits"></td><td class="source">  // All other routes should redirect to the index.html</td></tr><tr class="hit"><td class="line">24</td><td class="hits">1</td><td class="source">  app.route('/*')</td></tr><tr><td class="line">25</td><td class="hits"></td><td class="source">    .get(function(req, res) {</td></tr><tr class="miss"><td class="line">26</td><td class="hits">0</td><td class="source">      res.sendfile(app.get('appPath') + '/index.html');</td></tr><tr><td class="line">27</td><td class="hits"></td><td class="source">    });</td></tr><tr><td class="line">28</td><td class="hits"></td><td class="source">};</td></tr><tr><td class="line">29</td><td class="hits"></td><td class="source"> </td></tr></tbody></table></div></div></div></body></html>